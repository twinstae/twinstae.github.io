import{S as e,i as t,s as n,e as s,c as i,a as o,d as r,b as l,f as a,B as d,Q as c,R as u,q as p,T as h,N as f,v as g,x as y,C as m,U as b,j as v,V as N}from"./index-f2c05835.js";const C=window;function T(e,t,n={}){const s=Object.assign({tab:"\t",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:C},n),i=s.window,o=i.document;let r,l,a=[],d=[],c=-1,u=!1;e.setAttribute("contenteditable","plaintext-only"),e.setAttribute("spellcheck",s.spellcheck?"true":"false"),e.style.outline="none",e.style.overflowWrap="break-word",e.style.overflowY="auto",e.style.whiteSpace="pre-wrap";let p=!1;t(e),"plaintext-only"!==e.contentEditable&&(p=!0),p&&e.setAttribute("contenteditable","true");const h=M((()=>{const n=b();t(e,n),v(n)}),30);let f=!1;const g=e=>!k(e)&&!O(e)&&"Meta"!==e.key&&"Control"!==e.key&&"Alt"!==e.key&&!e.key.startsWith("Arrow"),y=M((e=>{g(e)&&(x(),f=!1)}),300),m=(t,n)=>{a.push([t,n]),e.addEventListener(t,n)};function b(){const t=A(),n={start:0,end:0,dir:void 0};let{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:l}=t;if(!s||!r)throw"error1";if(s.nodeType===Node.ELEMENT_NODE){const e=o.createTextNode("");s.insertBefore(e,s.childNodes[i]),s=e,i=0}if(r.nodeType===Node.ELEMENT_NODE){const e=o.createTextNode("");r.insertBefore(e,r.childNodes[l]),r=e,l=0}return E(e,(e=>{if(e===s&&e===r)return n.start+=i,n.end+=l,n.dir=i<=l?"->":"<-","stop";if(e===s){if(n.start+=i,n.dir)return"stop";n.dir="->"}else if(e===r){if(n.end+=l,n.dir)return"stop";n.dir="<-"}e.nodeType===Node.TEXT_NODE&&("->"!=n.dir&&(n.start+=e.nodeValue.length),"<-"!=n.dir&&(n.end+=e.nodeValue.length))})),e.normalize(),n}function v(t){const n=A();let s,i,o=0,r=0;if(t.dir||(t.dir="->"),t.start<0&&(t.start=0),t.end<0&&(t.end=0),"<-"==t.dir){const{start:e,end:n}=t;t.start=n,t.end=e}let l=0;E(e,(e=>{if(e.nodeType!==Node.TEXT_NODE)return;const n=(e.nodeValue||"").length;if(l+n>t.start&&(s||(s=e,o=t.start-l),l+n>t.end))return i=e,r=t.end-l,"stop";l+=n})),s||(s=e,o=e.childNodes.length),i||(i=e,r=e.childNodes.length),"<-"==t.dir&&([s,o,i,r]=[i,r,s,o]),n.setBaseAndExtent(s,o,i,r)}function N(){const t=A().getRangeAt(0),n=o.createRange();return n.selectNodeContents(e),n.setEnd(t.startContainer,t.startOffset),n.toString()}function T(){const t=A().getRangeAt(0),n=o.createRange();return n.selectNodeContents(e),n.setStart(t.endContainer,t.endOffset),n.toString()}function w(e){if(p&&"Enter"===e.key)if(D(e),e.stopPropagation(),""==T()){S("\n ");const e=b();e.start=--e.end,v(e)}else S("\n")}function x(){if(!u)return;const t=e.innerHTML,n=b(),s=d[c];if(s&&s.html===t&&s.pos.start===n.start&&s.pos.end===n.end)return;c++,d[c]={html:t,pos:n},d.splice(c+1);c>300&&(c=300,d.splice(0,1))}function E(e,t){const n=[];e.firstChild&&n.push(e.firstChild);let s=n.pop();for(;s&&"stop"!==t(s);)s.nextSibling&&n.push(s.nextSibling),s.firstChild&&n.push(s.firstChild),s=n.pop()}function L(e){return e.metaKey||e.ctrlKey}function k(e){return L(e)&&!e.shiftKey&&"KeyZ"===e.code}function O(e){return L(e)&&e.shiftKey&&"KeyZ"===e.code}function S(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),o.execCommand("insertHTML",!1,e)}function M(e,t){let n=0;return(...s)=>{clearTimeout(n),n=i.setTimeout((()=>e(...s)),t)}}function $(e){let t=e.length-1;for(;t>=0&&"\n"!==e[t];)t--;t++;let n=t;for(;n<e.length&&/[ \t]/.test(e[n]);)n++;return[e.substring(t,n)||"",t,n]}function R(){return e.textContent||""}function D(e){e.preventDefault()}function A(){var t;return(null===(t=e.parentNode)||void 0===t?void 0:t.nodeType)==Node.DOCUMENT_FRAGMENT_NODE?e.parentNode.getSelection():i.getSelection()}return m("keydown",(t=>{t.defaultPrevented||(l=R(),s.preserveIdent?function(e){if("Enter"===e.key){const t=N(),n=T();let[i]=$(t),o=i;if(s.indentOn.test(t)&&(o+=s.tab),o.length>0?(D(e),e.stopPropagation(),S("\n"+o)):w(e),o!==i&&s.moveToNewLine.test(n)){const e=b();S("\n"+i),v(e)}}}(t):w(t),s.catchTab&&function(e){if("Tab"===e.key)if(D(e),e.shiftKey){const e=N();let[t,n]=$(e);if(t.length>0){const e=b(),i=Math.min(s.tab.length,t.length);v({start:n,end:n+i}),o.execCommand("delete"),e.start-=i,e.end-=i,v(e)}}else S(s.tab)}(t),s.addClosing&&function(e){const t="([{'\"",n=")]}'\"",s=T(),i=N(),o="\\"===i.substr(i.length-1),r=s.substr(0,1);if(n.includes(e.key)&&!o&&r===e.key){const t=b();D(e),t.start=++t.end,v(t)}else if(t.includes(e.key)&&!o&&("\"'".includes(e.key)||[""," ","\n"].includes(r))){D(e);const s=b(),i=s.start==s.end?"":A().toString();S(e.key+i+n[t.indexOf(e.key)]),s.start++,s.end++,v(s)}}(t),s.history&&(!function(t){if(k(t)){D(t),c--;const n=d[c];n&&(e.innerHTML=n.html,v(n.pos)),c<0&&(c=0)}if(O(t)){D(t),c++;const n=d[c];n&&(e.innerHTML=n.html,v(n.pos)),c>=d.length&&c--}}(t),g(t)&&!f&&(x(),f=!0)),p&&v(b()))})),m("keyup",(e=>{e.defaultPrevented||e.isComposing||(l!==R()&&h(),y(e),r&&r(R()))})),m("focus",(e=>{u=!0})),m("blur",(e=>{u=!1})),m("paste",(n=>{x(),function(n){D(n);const s=(n.originalEvent||n).clipboardData.getData("text/plain").replace(/\r/g,""),i=b();S(s),t(e),v({start:Math.min(i.start,i.end)+s.length,end:Math.min(i.start,i.end)+s.length,dir:"<-"})}(n),x(),r&&r(R())})),{updateOptions(e){Object.assign(s,e)},updateCode(n){e.textContent=n,t(e)},onUpdate(e){r=e},toString:R,save:b,restore:v,recordHistory:x,destroy(){for(let[t,n]of a)e.removeEventListener(t,n)}}}function w(e,t={}){const n=Object.assign({class:"codejar-linenumbers",wrapClass:"codejar-wrap",width:"35px",backgroundColor:"rgba(128, 128, 128, 0.15)",color:""},t);let s;return function(t){e(t),s||(s=function(e,t){const n=getComputedStyle(e),s=document.createElement("div");s.className=t.wrapClass,s.style.position="relative";const i=document.createElement("div");i.className=t.class,s.appendChild(i),i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.bottom="0px",i.style.width=t.width,i.style.overflow="hidden",i.style.backgroundColor=t.backgroundColor,i.style.color=t.color||n.color,i.style.setProperty("mix-blend-mode","difference"),i.style.fontFamily=n.fontFamily,i.style.fontSize=n.fontSize,i.style.lineHeight=n.lineHeight,i.style.paddingTop=n.paddingTop,i.style.paddingLeft=n.paddingLeft,i.style.borderTopLeftRadius=n.borderTopLeftRadius,i.style.borderBottomLeftRadius=n.borderBottomLeftRadius;const o=document.createElement("div");return o.style.position="relative",o.style.top="0px",i.appendChild(o),e.style.paddingLeft=`calc(${t.width} + ${i.style.paddingLeft})`,e.style.whiteSpace="pre",e.parentNode.insertBefore(s,e),s.appendChild(e),o}(t,n),t.addEventListener("scroll",(()=>s.style.top=`-${t.scrollTop}px`)));const i=(t.textContent||"").replace(/\n+$/,"\n").split("\n").length+1;let o="";for(let e=1;e<i;e++)o+=`${e}\n`;s.innerText=o}}function x(e,t){let{highlight:n,onUpdate:s,syntax:i,value:o,withLineNumbers:r,...l}=t,a=T(e,u(n),l);function d(){a.destroy();const t=e.parentElement;if(t&&t.classList.contains("codejar-wrap")){const n=t.parentElement;e.style.padding="",n.appendChild(e),t.remove()}}function c(e){s&&s(a.toString())}function u(e){const t=e?t=>{var n;t.innerHTML=e(null!==(n=t.textContent)&&void 0!==n?n:"",i)}:e=>{};return r?w(t):t}return e.addEventListener("input",c),{destroy(){d(),e.removeEventListener("input",c)},update(c){({highlight:n,onUpdate:s,syntax:i,value:o,withLineNumbers:r,...l}=c),t.highlight!==n||t.withLineNumbers!==r?(d(),a=T(e,u(n),t)):a.updateOptions(l),o!==a.toString()&&a.updateCode(o),t={highlight:n,value:o,withLineNumbers:r,...l}}}}function E(e){let t;return{c(){t=g(e[1])},l(n){t=y(n,e[1])},m(e,n){a(e,t,n)},p(e,n){2&n&&m(t,e[1])},d(e){e&&r(t)}}}function L(e){let t,n,s=e[12](e[1],e[13])+"";return{c(){t=new b(!1),n=v(),this.h()},l(e){t=N(e,!1),n=v(),this.h()},h(){t.a=n},m(e,i){t.m(s,e,i),a(e,n,i)},p(e,n){12290&n&&s!==(s=e[12](e[1],e[13])+"")&&t.p(s)},d(e){e&&r(n),e&&t.d()}}}function k(e){let t,n,h,f,g,y,m,b;function v(e,t){return e[12]?L:E}let N=v(e),C=N(e);return{c(){t=s("pre"),n=s("code"),C.c(),this.h()},l(e){t=i(e,"PRE",{class:!0,style:!0});var s=o(t);n=i(s,"CODE",{class:!0});var l=o(n);C.l(l),l.forEach(r),s.forEach(r),this.h()},h(){l(n,"class",h=e[13]?`language-${e[13]}`:""),l(t,"class",f=(e[13]?`language-${e[13]}`:"")+" "+(e[2]??"")),l(t,"style",g=e[3]?e[3]:"")},m(s,i){a(s,t,i),d(t,n),C.m(n,null),e[15](t),m||(b=c(y=x.call(null,t,{addClosing:e[4],catchTab:e[5],highlight:e[12],history:e[6],indentOn:e[7],onUpdate:e[14],preserveIdent:e[8],spellcheck:e[9],syntax:e[13],tab:e[10],value:e[1],withLineNumbers:e[11]})),m=!0)},p(e,[s]){N===(N=v(e))&&C?C.p(e,s):(C.d(1),C=N(e),C&&(C.c(),C.m(n,null))),8192&s&&h!==(h=e[13]?`language-${e[13]}`:"")&&l(n,"class",h),8196&s&&f!==(f=(e[13]?`language-${e[13]}`:"")+" "+(e[2]??""))&&l(t,"class",f),8&s&&g!==(g=e[3]?e[3]:"")&&l(t,"style",g),y&&u(y.update)&&16370&s&&y.update.call(null,{addClosing:e[4],catchTab:e[5],highlight:e[12],history:e[6],indentOn:e[7],onUpdate:e[14],preserveIdent:e[8],spellcheck:e[9],syntax:e[13],tab:e[10],value:e[1],withLineNumbers:e[11]})},i:p,o:p,d(n){n&&r(t),C.d(),e[15](null),m=!1,b()}}}function O(e,t,n){const s=h();let{element:i}=t,{class:o}=t,{style:r}=t,{addClosing:l=!0}=t,{catchTab:a=!0}=t,{history:d=!0}=t,{indentOn:c=/{$/}=t,{preserveIdent:u=!0}=t,{spellcheck:p=!1}=t,{tab:g="\t"}=t,{withLineNumbers:y}=t,{highlight:m}=t,{syntax:b}=t,{value:v=""}=t;return e.$$set=e=>{"element"in e&&n(0,i=e.element),"class"in e&&n(2,o=e.class),"style"in e&&n(3,r=e.style),"addClosing"in e&&n(4,l=e.addClosing),"catchTab"in e&&n(5,a=e.catchTab),"history"in e&&n(6,d=e.history),"indentOn"in e&&n(7,c=e.indentOn),"preserveIdent"in e&&n(8,u=e.preserveIdent),"spellcheck"in e&&n(9,p=e.spellcheck),"tab"in e&&n(10,g=e.tab),"withLineNumbers"in e&&n(11,y=e.withLineNumbers),"highlight"in e&&n(12,m=e.highlight),"syntax"in e&&n(13,b=e.syntax),"value"in e&&n(1,v=e.value)},[i,v,o,r,l,a,d,c,u,p,g,y,m,b,function(e){n(1,v=e),s("change",{value:e})},function(e){f[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}var S=class extends e{constructor(e){super(),t(this,e,O,k,n,{element:0,class:2,style:3,addClosing:4,catchTab:5,history:6,indentOn:7,preserveIdent:8,spellcheck:9,tab:10,withLineNumbers:11,highlight:12,syntax:13,value:1})}};export{S as CodeJar};

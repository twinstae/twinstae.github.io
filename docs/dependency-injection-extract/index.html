<!DOCTYPE html><html lang="ko-KR"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>테스트로 보는 DI - 함수와 변수 추출</title><meta name="description" content="테스트를 통해 수 많은 의존성 주입 기법을 탐구합니다. 그 시작은 변수와 함수부터입니다...." data-svelte="svelte-18tnbae"><link href="https://twinstae.github.io/dependency-injection-extract/" rel="canonical" data-svelte="svelte-18tnbae"><meta property="og:site_name" content="진리의 배 조선소" data-svelte="svelte-18tnbae"><meta property="og:url" content="https://twinstae.github.io/dependency-injection-extract/" data-svelte="svelte-18tnbae"><meta property="og:title" content="테스트로 보는 DI - 함수와 변수 추출" data-svelte="svelte-18tnbae"><meta property="og:image" content="https://twinstae.github.io/TamjungRabbitProfile.jpg" data-svelte="svelte-18tnbae"><meta property="og:description" content="테스트를 통해 수 많은 의존성 주입 기법을 탐구합니다. 그 시작은 변수와 함수부터입니다...." data-svelte="svelte-18tnbae"><meta name="twitter:card" content="summary" data-svelte="svelte-18tnbae"><meta name="twitter:url" content="https://twinstae.github.io/dependency-injection-extract/" data-svelte="svelte-18tnbae"><meta name="twitter:title" content="테스트로 보는 DI - 함수와 변수 추출" data-svelte="svelte-18tnbae"><meta name="twitter:description" content="테스트를 통해 수 많은 의존성 주입 기법을 탐구합니다. 그 시작은 변수와 함수부터입니다...." data-svelte="svelte-18tnbae"><meta name="twitter:image" content="https://twinstae.github.io/TamjungRabbitProfile.jpg" data-svelte="svelte-18tnbae"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous" data-svelte="svelte-y2267v"><script data-svelte="svelte-y2267v">setTimeout(() => {
      const codes = document.getElementsByTagName('pre');

      for (const code of codes) {
        if (code.parentElement.className.includes('codejar-wrap')){
          continue;
        }
        code.addEventListener('dblclick', function (e) {
          navigator.clipboard.writeText(code.innerText).then(() => {
            alert('코드를 클립보드에 복사했습니다.');
          });
        });
      }
    }, 500);
  </script><script data-svelte="svelte-y2267v">let is_dark = localStorage.getItem('dark') == 'true';
    document.getElementsByTagName('html')[0].className = is_dark
      ? 'dark'
      : 'light';
  </script><link rel="prefetch" href="/_elderjs/svelte/components/DarkCheckBox.d7e8c32b.js" as="script"><link rel="stylesheet" href="/_elderjs/assets/svelte-968ab9b4.css" media="all" /><style></style></head><body class="blog">
<nav id="top-nav-bar" class="svelte-d4ohrk"><div class="darkcheckbox-component" id="darkcheckbox-ejs-LQkbMnstNJ"><input type="checkbox" id="darkmode-checkbox" class="svelte-ixwbnm">
<label for="darkmode-checkbox" class="svelte-ixwbnm"><span class="svelte-ixwbnm"></span>
  <span class="svelte-ixwbnm"></span>
</label></div>
  <a href="/" aria-current="false">진리의 배 조선소 </a>
  </nav>

<article class="container svelte-d4ohrk"><!-- HTML_TAG_START -->

<a href="/">← Home</a>

<div class="title svelte-7s3agc"><h1 id="title-heading">테스트로 보는 DI - 함수와 변수 추출</h1>
  <div><span class="hashtag">#테스트
        </span><span class="hashtag">#DI
        </span><span class="hashtag">#리팩토링
        </span></div>
  <small>By 탐정토끼(Taehee Kim)</small></div>

<a id="scroll-top-button" href="#title-heading" class="svelte-12gmvis">↑ 맨 위로</a>

<nav class="svelte-s59jxg"><div><span>목차</span>
    <ol><li style="font-size: 1.25rem;"><a href="#요약" style="color: #868e96;">요약</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#하드코딩된-코드는-변경에-취약합니다" style="color: #868e96;">하드코딩된 코드는 변경에 취약합니다</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#변수로-추출하기" style="color: #868e96;">변수로 추출하기</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#상수의-한계-성급한-추상화인가" style="color: #868e96;">상수의 한계. 성급한 추상화인가?</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#함수에-동적으로-매개변수를-주입하자" style="color: #868e96;">함수에 동적으로 매개변수를 주입하자</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#좁은-인터페이스-넓은-인터페이스" style="color: #868e96;">좁은 인터페이스, 넓은 인터페이스</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#오해-바로잡기-매개변수가-많다고-넓은-인터페이스는-아니다" style="color: #868e96;">오해 바로잡기. 매개변수가 많다고 넓은 인터페이스는 아니다.</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#개념은-하나-적용은-무궁무진" style="color: #868e96;">개념은 하나, 적용은 무궁무진</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#언제든지-돌아갈-수-있다" style="color: #868e96;">언제든지 돌아갈 수 있다</a>
        <ol>
        </ol>
      </li><li style="font-size: 1.25rem;"><a href="#다음-회-예고-prop-내리기와-의존성-주입의-고통" style="color: #868e96;">다음 회 예고... prop 내리기와 의존성 주입의 고통</a>
        <ol>
        </ol>
      </li></ol></div>
</nav>

<!-- HTML_TAG_START --><p><a href="https://twinstae.github.io/testing-with-dependency-injection/">프런트엔드에서 의존성을 제어하는 법</a>에서는 의존성 주입이 필요한 이유만 다뤘는데도 너무 길어졌습니다. 지난 글에서 언급한 것처럼, 의존성 주입은 거창한 의존성 주입 도구를 통해서만 가능한 것도 아니며, 객체지향에서만 필요한 방법론도 아닙니다.</p>
<p>이제부터는 실전으로 들어가서. 여러 의존성 주입 기법을 하나씩 살펴보고, 설계에 어떤 영향을 주는지 관찰해보겠습니다.</p>
<p>그 첫 번째 주인공은 <code>변수 variable</code>와 <code>함수 function</code>입니다.</p>
<h2 id="요약">요약</h2>
<blockquote>
<p>하드코딩된 코드는 결합된 코드의 범위를 늘리고, 같이 변하는 것들을 따로따로 바꿔야해서 귀찮아 집니다.</p>
<p>이런 때 의존성 주입을 통해서, 간접적인 인터페이스에 의존하도록 분리해내면 좋습니다.</p>
<p>변수나 함수를 추출하는 리팩토링은 단순하고 되돌리기도 쉬운 의존성 주입 기법입니다.</p>
<p>도메인, 시스템, 사용자를 생각하면서 의미 있고 같이 변하는 단위를 식별해야 합니다.</p>
<p>발견한 중복을 적절한 스코프의 상수 혹은 변수로 추출합니다.</p>
<p>동적으로 다른 값을 주입 받고 싶거나, 매번 새로 부수효과를 일으켜야 한다면 함수나 프로시저로 추출합니다.</p>
<p>함수는 비슷한 로직을 의존하는 입력만 다르게 주입해주면, 풍부하게 활용할 수 있습니다.</p>
<p>상황이 변하더라도 함수에 매개변수를 늘리고, 부분적용을 통해 원하는 만큼 구체화된 함수를 만들어낼 수 있습니다.</p>
</blockquote>
<p>이 요약이 이해가 안 가신다면 글을 계속 읽으시면 됩니다. 다 읽고 다시 와서 읽어보세요. ;)</p>
<h2 id="하드코딩된-코드는-변경에-취약합니다">하드코딩된 코드는 변경에 취약합니다</h2>
<p>의존성 주입에 반대가 있다면, 하드코딩된 코드일 것입니다. 이런 코드는 구현체를 갈아 끼우기 어렵고. 테스트 뿐만 아니라 변경할 때마다 눈물을 흘리게 합니다.</p>
<p>다음은 제가 지금 작업 중인 역량 배지의 테스트를 가지고 만들어 본, 하드코딩된 테스트의 예시입니다. <code>TagsInput</code>은 여러 태그를 입력할 수 있는 컴포넌트인데, <a href="https://zagjs.com/components/react/tags-input">zagjs</a>를 기반으로 커스텀을 했습니다.</p>
<p>두 테스트 사이에는 중복이 있으니 찾아보시죠.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #676E95; font-style: italic">// TagsInput.test.tsx</span></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">add and delete</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    /&gt;,</span></span>
<span class="line"><span style="color: #F07178">  )</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 역량이라는 라벨에 연결된 input을 찾아옵니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">$addInput</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getByLabelText</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// react라는 값을 입력합니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">userEvent</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">type</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">$addInput</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">{enter}react{enter}</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// react tag가 추가되면서, 삭제하는 버튼도 가져올 수 있게 됩니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">$reactDeleteTag</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getByRole</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">button</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    name</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react 태그를 삭제</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 삭제 버튼을 클릭하면</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">userEvent</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">click</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">$reactDeleteTag</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 그러면 버튼을 document 안에서 찾을 수 없게 됩니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">expect</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">queryByRole</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">button</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">))</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">not</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">toBeInTheDocument</span><span style="color: #F07178">()</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">후보에 없는 값은 추가 되지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    /&gt;,</span></span>
<span class="line"><span style="color: #F07178">  )</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">$addInput</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getByLabelText</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">userEvent</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">type</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">$addInput</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">{enter}not-in-candidate{enter}</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">expect</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">queryByRole</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">button</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">))</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">not</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">toBeInTheDocument</span><span style="color: #F07178">()</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>맞습니다. <code>TagsInput</code> 컴포넌트를 <code>render</code> 하는 부분이 완전히 똑같습니다.</p>
<p>복사 붙여넣기는 처음에는 나쁘지 않게 보입니다. 성급한 추상화는 나쁘다고도 하고, test는 촉촉하고 명확한 게 좋다고도 하지 않습니까? 중복이라고 다 나쁜 건 아니니. 해명할 기회를 줄 수도 있겠어요.</p>
<p>하지만 역할을 생각하면, 이건 좋은 중복이 아닙니다.</p>
<p>이 두 코드는 props 값에 따라 컴포넌트가 어떻게 변하는지 테스트하고 싶은 게 아닙니다. 처음에는 완전히 동일한 props로 렌더링하는데, 사용자가 다른 값을 입력했을 때, 동작이 어떻게 달라지는지를 테스트하고 있습니다.</p>
<p>그러면 앞의 두 <code>render</code>는 오히려 두 테스트에서 같아야 하는 부분입니다. 중복된 하드코딩은 <code>TagsInput</code>에 직접 의존하며 결합도를 늘리고, 변경할 때마다 중복된 노력이 들게 합니다.</p>
<p>예를 들어 component의 props가 달라진다면... 같이 변해야 할 겁니다. 역량 배지의 상황에 맞게 세세한 옵션을 추가하다보니, props가 늘어날 것은 당연한 이야기입니다.</p>
<p><code>TagsInput</code>이 기존에 서버에 있던 데이터를 수정한다면, 초기 값으로 서버에서 가져온 원래 데이터를 넣어주고 싶을 수 있습니다. 그래서 <code>initValue</code>라는 prop을 추가해줍니다.</p>
<div class="hl-lines-6 hl-lines-12"></div>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #676E95; font-style: italic">// TagsInput.tsx</span></span>
<span class="line"><span style="color: #89DDFF; font-style: italic">export</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF; font-style: italic">default</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">TagsInput</span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">S</span><span style="color: #89DDFF">&gt;({</span></span>
<span class="line"><span style="color: #A6ACCD">	name</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">	labelText</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">	errors</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">	initValue</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #89DDFF">	</span><span style="color: #676E95; font-style: italic">// ... 생략</span></span>
<span class="line"><span style="color: #89DDFF">}:</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">	</span><span style="color: #F07178">name</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">string</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">	</span><span style="color: #F07178">labelText</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">string</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">	</span><span style="color: #F07178">errors</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">FieldErrors</span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">S</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">|</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">undefined</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">	</span><span style="color: #F07178">initValue</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">string</span><span style="color: #A6ACCD">[]</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}){</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>테스트는 테스트 대상인 <code>TagsInput</code> 컴포넌트에 의존합니다. 의존 대상이 바뀌었으니, 테스트도 바꿔줘야 합니다. 의존성을 그려보면 다음과 같습니다.</p>
<p><svg id="mermaid-1674527394157" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="143" style="max-width: 513.469px; background-color: transparent;" viewBox="0 0 513.46875 143"><style>#mermaid-1674527394157 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527394157 .error-icon{fill:#552222;}#mermaid-1674527394157 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527394157 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527394157 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527394157 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527394157 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527394157 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527394157 .marker{fill:#666;stroke:#666;}#mermaid-1674527394157 .marker.cross{stroke:#666;}#mermaid-1674527394157 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527394157 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527394157 .cluster-label text{fill:#333;}#mermaid-1674527394157 .cluster-label span{color:#333;}#mermaid-1674527394157 .label text,#mermaid-1674527394157 span{fill:#000000;color:#000000;}#mermaid-1674527394157 .node rect,#mermaid-1674527394157 .node circle,#mermaid-1674527394157 .node ellipse,#mermaid-1674527394157 .node polygon,#mermaid-1674527394157 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527394157 .node .label{text-align:center;}#mermaid-1674527394157 .node.clickable{cursor:pointer;}#mermaid-1674527394157 .arrowheadPath{fill:#333333;}#mermaid-1674527394157 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527394157 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527394157 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527394157 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527394157 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527394157 .cluster text{fill:#333;}#mermaid-1674527394157 .cluster span{color:#333;}#mermaid-1674527394157 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527394157 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-a LE-TagsInput" id="L-a-TagsInput" style="opacity: 1;"><path class="path" d="M88.28125,96.5L88.28125,92.25C88.28125,88,88.28125,79.5,103.64322916666667,70.3114380577278C119.00520833333333,61.1228761154556,149.72916666666666,51.2457522309112,165.09114583333334,46.307190288639L180.453125,41.368628346366805" marker-end="url(#arrowhead8)" style="fill:none"></path><defs><marker id="arrowhead8" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-b LE-TagsInput" id="L-b-TagsInput" style="opacity: 1;"><path class="path" d="M362.015625,96L362.015625,91.83333333333333C362.015625,87.66666666666667,362.015625,79.33333333333333,346.6536458333333,70.22810472439447C331.2916666666667,61.1228761154556,300.5677083333333,51.2457522309112,285.2057291666667,46.307190288639L269.84375,41.368628346366805" marker-end="url(#arrowhead9)" style="fill:none"></path><defs><marker id="arrowhead9" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-a-TagsInput" class="edgeLabel L-LS-a' L-LE-TagsInput"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-b-TagsInput" class="edgeLabel L-LS-b' L-LE-TagsInput"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-a-4" transform="translate(88.28125,115.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-80.28125" y="-19" width="160.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-70.28125,-9)"><foreignObject width="140.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: add and delete</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-5" transform="translate(225.1484375,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g><g class="node default" id="flowchart-b-6" transform="translate(362.015625,115.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-143.453125" y="-19.5" width="286.90625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-133.453125,-9.5)"><foreignObject width="266.90625" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: 후보에 없는 값은 추가 되지 않는다</div></foreignObject></g></g></g></g></g></g></svg></p>
<p>테스트부터 바꾸면 더 tdd스럽다고 생각하실지도 모르겠습니다. 하지만 저는 타입스크립트를 쓰고 있고, type 정의를 바꾸는 것도 테스트와 비슷합니다. 바뀐 type 인터페이스에 따라 테스트에서 에러가 납니다. type이 테스트를 테스트하고 있는 셈이죠.</p>
<p>보면 <code>TagsInput</code>을 <code>render</code>하는 부분에서 에러가 납니다. 고쳐줄까요?</p>
<div class="hl-lines-11"></div>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #676E95; font-style: italic">// TagsInput.test.tsx</span></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">add and delete</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">initValue</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    /&gt;,</span></span>
<span class="line"><span style="color: #F07178">  )</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span></span></code></pre>
<p>문제는 여기서부터입니다. 테스트가 하나 더 있으니 똑같은 수정을 한 번 더 해줘야 합니다. 만약 테스트가 2개, 3개... 점점 늘어난다면 어떨까요? 역량 배지에는 TagsInput 컴포넌트 하나를 테스트하는 코드만 현재 6개나 있습니다.</p>
<p>테스트도 코드이며, 유지보수하기 쉽게 의존성을 관리해야 합니다. 코드를 한 두 변경할 때마다 테스트를 6~12줄 씩 고쳐야 한다면, 테스트를 짜고 싶어 하는 사람은 많지 않을 겁니다.</p>
<p>대안이 있을까요? 생각보다 쉽지요. 바로 변수나 함수로 추출(extract)하는 겁니다.</p>
<h2 id="변수로-추출하기">변수로 추출하기</h2>
<p>저는 마틴 파울러가 쓴 [리팩토링]이라는 책에서 변수 추출이라는 용어를 배웠습니다. 변수 추출은 너무 흔해서 IDE들은 물론 vs code나 vim 같은 에디터에서도 <a href="https://zetawiki.com/wiki/%EC%96%B8%EC%96%B4_%EC%84%9C%EB%B2%84_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C">LSP</a>를 통해 기능으로 지원해주기도 합니다.</p>
<p>변수 추출은 간단합니다. 중복된 부분을 변수로 빼서 재사용하면 되지요.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">const</span><span style="color: #A6ACCD"> emptyTagsInputElement </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">initValue</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">  /&gt;,</span></span>
<span class="line"><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>이제 이 <code>emptyTagsInputElement</code>를 테스트에 사용합니다. test들은 TagsInput에 직접 의존하지 않고, <code>emptyTagsInputElement</code>에 간접 의존하게 됩니다.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">add and delete</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">emptyTagsInputElement</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">후보에 없는 값은 추가 되지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">emptyTagsInputElement</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span></span></code></pre>
<p>이제 <code>TagsInput</code>의 interface가 변경되더라도 <code>emptyTagsInputElement</code>만 변경해주면 됩니다.</p>
<p>단순히 재사용을 편하게 하기 위해 변수를 추출한 게 아닙니다. 관찰하면서 같이 변하는, 즉 역할이 같은 부분을 추출한 것이죠. 덕분에 결합도를 낮추고 유연해질 수 있었습니다.</p>
<p>의존성을 다시 그려보면 다음과 같습니다.</p>
<p><svg id="mermaid-1674527394483" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="231" style="max-width: 513.469px; background-color: transparent;" viewBox="0 0 513.46875 231"><style>#mermaid-1674527394483 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527394483 .error-icon{fill:#552222;}#mermaid-1674527394483 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527394483 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527394483 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527394483 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527394483 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527394483 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527394483 .marker{fill:#666;stroke:#666;}#mermaid-1674527394483 .marker.cross{stroke:#666;}#mermaid-1674527394483 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527394483 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527394483 .cluster-label text{fill:#333;}#mermaid-1674527394483 .cluster-label span{color:#333;}#mermaid-1674527394483 .label text,#mermaid-1674527394483 span{fill:#000000;color:#000000;}#mermaid-1674527394483 .node rect,#mermaid-1674527394483 .node circle,#mermaid-1674527394483 .node ellipse,#mermaid-1674527394483 .node polygon,#mermaid-1674527394483 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527394483 .node .label{text-align:center;}#mermaid-1674527394483 .node.clickable{cursor:pointer;}#mermaid-1674527394483 .arrowheadPath{fill:#333333;}#mermaid-1674527394483 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527394483 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527394483 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527394483 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527394483 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527394483 .cluster text{fill:#333;}#mermaid-1674527394483 .cluster span{color:#333;}#mermaid-1674527394483 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527394483 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-a LE-emptyTagsInputElement" id="L-a-emptyTagsInputElement" style="opacity: 1;"><path class="path" d="M88.28125,184.5L88.28125,180.25C88.28125,176,88.28125,167.5,101.24215790719695,159.08333333333334C114.20306581439394,150.66666666666666,140.12488162878788,142.33333333333334,153.08578953598484,138.16666666666666L166.0466974431818,134" marker-end="url(#arrowhead13)" style="fill:none"></path><defs><marker id="arrowhead13" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-b LE-emptyTagsInputElement" id="L-b-emptyTagsInputElement" style="opacity: 1;"><path class="path" d="M362.015625,184L362.015625,179.83333333333334C362.015625,175.66666666666666,362.015625,167.33333333333334,349.054717092803,159C336.09380918560606,150.66666666666666,310.1719933712121,142.33333333333334,297.2110854640152,138.16666666666666L284.2501775568182,134" marker-end="url(#arrowhead14)" style="fill:none"></path><defs><marker id="arrowhead14" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-emptyTagsInputElement LE-TagsInput" id="L-emptyTagsInputElement-TagsInput" style="opacity: 1;"><path class="path" d="M225.1484375,96L225.1484375,91.83333333333333C225.1484375,87.66666666666667,225.1484375,79.33333333333333,225.1484375,71C225.1484375,62.666666666666664,225.1484375,54.333333333333336,225.1484375,50.166666666666664L225.1484375,46" marker-end="url(#arrowhead15)" style="fill:none"></path><defs><marker id="arrowhead15" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-a-emptyTagsInputElement" class="edgeLabel L-LS-a' L-LE-emptyTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-b-emptyTagsInputElement" class="edgeLabel L-LS-b' L-LE-emptyTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-emptyTagsInputElement-TagsInput" class="edgeLabel L-LS-emptyTagsInputElement' L-LE-TagsInput"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-a-6" transform="translate(88.28125,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-80.28125" y="-19" width="160.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-70.28125,-9)"><foreignObject width="140.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: add and delete</div></foreignObject></g></g></g><g class="node default" id="flowchart-emptyTagsInputElement-7" transform="translate(225.1484375,115)" style="opacity: 1;"><rect rx="0" ry="0" x="-95.828125" y="-19" width="191.65625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-85.828125,-9)"><foreignObject width="171.65625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">emptyTagsInputElement</div></foreignObject></g></g></g><g class="node default" id="flowchart-b-8" transform="translate(362.015625,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-143.453125" y="-19.5" width="286.90625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-133.453125,-9.5)"><foreignObject width="266.90625" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: 후보에 없는 값은 추가 되지 않는다</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-11" transform="translate(225.1484375,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g></g></g></g></svg></p>
<h2 id="상수의-한계-성급한-추상화인가">상수의 한계. 성급한 추상화인가?</h2>
<p>이제 새로운 테스트를 더 추가해보겠습니다. <code>TagsInput</code>에는 개수 제한이 있습니다. 최대 개수인 2개에 도달하면, 더 이상 input이 보이지 않도록 하고 싶습니다.</p>
<p>문제는 이를 테스트하기 위해서는 2개의 tag를 미리 추가해줘야 한다는 겁니다. 다음처럼 할 수 있습니다.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">2개 제한을 넘으면 input이 보이지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 빈 TagsInput을 렌더합니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">emptyTagsInputElement</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">$addInput</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getByLabelText</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// rescript 태그를 추가합니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">userEvent</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">type</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">$addInput</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript{enter}</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// svelte 태그를 추가합니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">userEvent</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">type</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">$addInput</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte{enter}</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 더 이상 역량 라벨에 연결된 input이 document에 존재하지 않습니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">expect</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">queryByLabelText</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">))</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">not</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">toBeInTheDocument</span><span style="color: #F07178">()</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>현실적인 시나리오이긴 하지만, 테스트 사이에 결합도가 높아졌습니다. 예를 들어 태그를 추가하는 기능이 망가졌지만, 최대 개수에 도달했을 때 input이 보이지 않도록 하는 기능은 잘 동작한다 해봅시다.</p>
<p>하지만 방금 만든 테스트 코드는 실패하게 됩니다. 왜냐면 태그를 추가하는 기능에도 의존하고 있기 때문입니다. 태그를 추가할 수 없으니, input은 사라지지 않고 테스트는 실패합니다. input의 최대 개수를 제한하는 기능은 멀쩡한데 말이죠!</p>
<p>잘 돌아가는데에도 문제가 있다고 거짓 경보가 울리는 현상. false positive한 테스트가 되버린 겁니다.</p>
<p>그러면 어떻게 해야할까요? 아까 저희는 <code>initValue</code>라는 prop을 만들었습니다. 이를 이용하면 초기 값을 지정해줄 수 있으니, 처음부터 두 개의 태그를 주입하고 시작하면 됩니다.</p>
<p>앗. 그런데 그러면 저희가 아까 만들었던 <code>emptyTagsInputElement</code> 상수는 사용할 수 없습니다. 약간 다른 두 번째 상수 <code>doubleTagsInputElement</code>를 만듭니다.</p>
<div class="hl-lines-9"></div>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">const</span><span style="color: #A6ACCD"> doubleTagsInputElement </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">initValue</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">  /&gt;,</span></span>
<span class="line"><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>이를 이용해서 테스트를 고치면 다음처럼 깔끔해집니다. tag를 추가하는 기능에도 의존하지 않기 때문에, 역할이 잘 분리된 좋은 테스트가 되었습니다.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">2개 제한을 넘으면 input이 보이지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 태그가 2개인 TagsInput을 렌더합니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">doubleTagsInputElement</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// 더 이상 역량 라벨에 연결된 input이 document에 존재하지 않습니다.</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">expect</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">screen</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">queryByLabelText</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">))</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">not</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">toBeInTheDocument</span><span style="color: #F07178">()</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>흠... 이러면 <code>initValue</code> prop에 무엇이 들어가는지에 따라서 새로운 변수를 매번 만들어줘야 합니다. 이런 낭패입니다. 복잡해지는 것도 문제지만, 앞서 이야기한 것처럼 <code>TagsInput</code>의 인터페이스가 변할 때마다 수 많은 변수들을 모두 업데이트해줘야 합니다. 변수를 추출하는 건 성급한 추상화였던 게 아닐까요?</p>
<p>현재 의존성 구조를 그려보면 다음과 같이 복잡해졌습니다.</p>
<p><svg id="mermaid-1674527394809" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="231" style="max-width: 893.969px; background-color: transparent;" viewBox="0 0 893.96875 231"><style>#mermaid-1674527394809 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527394809 .error-icon{fill:#552222;}#mermaid-1674527394809 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527394809 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527394809 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527394809 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527394809 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527394809 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527394809 .marker{fill:#666;stroke:#666;}#mermaid-1674527394809 .marker.cross{stroke:#666;}#mermaid-1674527394809 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527394809 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527394809 .cluster-label text{fill:#333;}#mermaid-1674527394809 .cluster-label span{color:#333;}#mermaid-1674527394809 .label text,#mermaid-1674527394809 span{fill:#000000;color:#000000;}#mermaid-1674527394809 .node rect,#mermaid-1674527394809 .node circle,#mermaid-1674527394809 .node ellipse,#mermaid-1674527394809 .node polygon,#mermaid-1674527394809 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527394809 .node .label{text-align:center;}#mermaid-1674527394809 .node.clickable{cursor:pointer;}#mermaid-1674527394809 .arrowheadPath{fill:#333333;}#mermaid-1674527394809 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527394809 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527394809 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527394809 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527394809 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527394809 .cluster text{fill:#333;}#mermaid-1674527394809 .cluster span{color:#333;}#mermaid-1674527394809 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527394809 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-a LE-emptyTagsInputElement" id="L-a-emptyTagsInputElement" style="opacity: 1;"><path class="path" d="M88.28125,184.5L88.28125,180.25C88.28125,176,88.28125,167.5,101.24215790719695,159.08333333333334C114.20306581439394,150.66666666666666,140.12488162878788,142.33333333333334,153.08578953598484,138.16666666666666L166.0466974431818,134" marker-end="url(#arrowhead15)" style="fill:none"></path><defs><marker id="arrowhead15" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-b LE-emptyTagsInputElement" id="L-b-emptyTagsInputElement" style="opacity: 1;"><path class="path" d="M362.015625,184L362.015625,179.83333333333334C362.015625,175.66666666666666,362.015625,167.33333333333334,349.054717092803,159C336.09380918560606,150.66666666666666,310.1719933712121,142.33333333333334,297.2110854640152,138.16666666666666L284.2501775568182,134" marker-end="url(#arrowhead16)" style="fill:none"></path><defs><marker id="arrowhead16" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-emptyTagsInputElement LE-TagsInput" id="L-emptyTagsInputElement-TagsInput" style="opacity: 1;"><path class="path" d="M225.1484375,96L225.1484375,91.83333333333333C225.1484375,87.66666666666667,225.1484375,79.33333333333333,247.59114583333334,69.66083692700846C270.0338541666667,59.9883405206836,314.9192708333333,48.97668104136719,337.3619791666667,43.47085130170899L359.8046875,37.965021562050794" marker-end="url(#arrowhead17)" style="fill:none"></path><defs><marker id="arrowhead17" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-c LE-doubleTagsInputElement" id="L-c-doubleTagsInputElement" style="opacity: 1;"><path class="path" d="M720.71875,184L720.71875,179.83333333333334C720.71875,175.66666666666666,720.71875,167.33333333333334,720.71875,159C720.71875,150.66666666666666,720.71875,142.33333333333334,720.71875,138.16666666666666L720.71875,134" marker-end="url(#arrowhead18)" style="fill:none"></path><defs><marker id="arrowhead18" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-doubleTagsInputElement LE-TagsInput" id="L-doubleTagsInputElement-TagsInput" style="opacity: 1;"><path class="path" d="M720.71875,96L720.71875,91.83333333333333C720.71875,87.66666666666667,720.71875,79.33333333333333,675.46484375,68.86984879928848C630.2109375,58.4063642652436,539.703125,45.8127285304872,494.44921875,39.515910663109004L449.1953125,33.2190927957308" marker-end="url(#arrowhead19)" style="fill:none"></path><defs><marker id="arrowhead19" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-a-emptyTagsInputElement" class="edgeLabel L-LS-a' L-LE-emptyTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-b-emptyTagsInputElement" class="edgeLabel L-LS-b' L-LE-emptyTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-emptyTagsInputElement-TagsInput" class="edgeLabel L-LS-emptyTagsInputElement' L-LE-TagsInput"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-c-doubleTagsInputElement" class="edgeLabel L-LS-c' L-LE-doubleTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-doubleTagsInputElement-TagsInput" class="edgeLabel L-LS-doubleTagsInputElement' L-LE-TagsInput"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-a-10" transform="translate(88.28125,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-80.28125" y="-19" width="160.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-70.28125,-9)"><foreignObject width="140.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: add and delete</div></foreignObject></g></g></g><g class="node default" id="flowchart-emptyTagsInputElement-11" transform="translate(225.1484375,115)" style="opacity: 1;"><rect rx="0" ry="0" x="-95.828125" y="-19" width="191.65625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-85.828125,-9)"><foreignObject width="171.65625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">emptyTagsInputElement</div></foreignObject></g></g></g><g class="node default" id="flowchart-b-12" transform="translate(362.015625,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-143.453125" y="-19.5" width="286.90625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-133.453125,-9.5)"><foreignObject width="266.90625" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: 후보에 없는 값은 추가 되지 않는다</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-15" transform="translate(404.5,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g><g class="node default" id="flowchart-c-16" transform="translate(720.71875,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-165.25" y="-19.5" width="330.5" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-155.25,-9.5)"><foreignObject width="310.5" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">text: 2개 제한을 넘으면 input이 보이지 않는다</div></foreignObject></g></g></g><g class="node default" id="flowchart-doubleTagsInputElement-17" transform="translate(720.71875,115)" style="opacity: 1;"><rect rx="0" ry="0" x="-98.0625" y="-19" width="196.125" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-88.0625,-9)"><foreignObject width="176.125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">doubleTagsInputElement</div></foreignObject></g></g></g></g></g></g></svg></p>
<p>괜찮습니다. 변수 추출은 간단하기 때문에, 되돌리는 데에도 큰 비용이 들지 않습니다. 이제 함수를 만날 시간입니다.</p>
<h2 id="함수에-동적으로-매개변수를-주입하자">함수에 동적으로 매개변수를 주입하자</h2>
<p>함수는 동적으로 매개변수를 주입해서, 매번 새로운 표현식을 만들어 낼 수 있습니다.</p>
<p>저는 함수를 추출할 때 먼저 중복되는 부분과, 달라지는 부분을 파악합니다. 그리고 달라지는 값을 매개변수로 주입하면 됩니다.</p>
<p>위에서 본 두 개의 변수를 관찰해보면, <code>initValue</code>를 제외하고 모두 똑같다는 걸 알 수 있습니다. 사실 관찰할 필요도 없었습니다. 저희는 복사 붙여넣기 하고 <code>initValue</code>를 바꿔준 것 빼고는 한 게 없으니까요!</p>
<p><code>initValue</code>를 매개변수로 바꿔서 함수로 만들면 다음과 같이 하면 됩니다.</p>
<div class="hl-lines-9"></div>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">const</span><span style="color: #A6ACCD"> tagsInputWithValue </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">initValue</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">string</span><span style="color: #A6ACCD">[]</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TagsInput</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">className</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mb-2</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">labelText</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">역량</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">name</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">skills</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">placeholder</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">ex) react</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">errors</span><span style="color: #89DDFF">={undefined}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">maxLength</span><span style="color: #89DDFF">={</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">initValue</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">initValue</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #C792EA">candidates</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">redux</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">vue</span><span style="color: #89DDFF">&#39;</span><span style="color: #A6ACCD">]</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">  /&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>이제 다음처럼 하나의 함수로 다양한 test를 유연하게 처리할 수 있습니다.</p>
<div class="hl-lines-2 hl-lines-6 hl-lines-10"></div>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">add and delete</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #82AAFF">tagsInputWithValue</span><span style="color: #F07178">([]))</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">후보에 없는 값은 추가 되지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #82AAFF">tagsInputWithValue</span><span style="color: #F07178">([]))</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span></span>
<span class="line"><span style="color: #82AAFF">it</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">2개 제한을 넘으면 input이 보이지 않는다</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">render</span><span style="color: #F07178">(</span><span style="color: #82AAFF">tagsInputWithValue</span><span style="color: #F07178">([</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rescript</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">svelte</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">]))</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">  </span><span style="color: #676E95; font-style: italic">// ... 이하 생략</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>의존 관계도 개선됩니다. 3가지 테스트는 하나의 <code>tagsInputWithValue</code>에만 의존합니다. <code>tagsInputWithValue</code>는 좁고 단순한 인터페이스로 <code>TagsInput</code>에 필요한 여러 props에 적절한 default 값을 넣어줍니다.</p>
<p>이를 함수형 프로그래밍에서는 부분 적용, 영어로는 파셜 어플리케이션(partial application)이라고 합니다. 함수에 여러 매개변수가 있을 때 일부 변수만 미리 넣어서, 더 적은 매개변수만 필요로 하는 함수로 만들어주는 것이죠.</p>
<p>의존 관계를 그려보면 다음과 같습니다.</p>
<p><svg id="mermaid-1674527395150" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="231" style="max-width: 893.969px; background-color: transparent;" viewBox="0 0 893.96875 231"><style>#mermaid-1674527395150 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527395150 .error-icon{fill:#552222;}#mermaid-1674527395150 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527395150 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527395150 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527395150 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527395150 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527395150 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527395150 .marker{fill:#666;stroke:#666;}#mermaid-1674527395150 .marker.cross{stroke:#666;}#mermaid-1674527395150 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527395150 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527395150 .cluster-label text{fill:#333;}#mermaid-1674527395150 .cluster-label span{color:#333;}#mermaid-1674527395150 .label text,#mermaid-1674527395150 span{fill:#000000;color:#000000;}#mermaid-1674527395150 .node rect,#mermaid-1674527395150 .node circle,#mermaid-1674527395150 .node ellipse,#mermaid-1674527395150 .node polygon,#mermaid-1674527395150 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527395150 .node .label{text-align:center;}#mermaid-1674527395150 .node.clickable{cursor:pointer;}#mermaid-1674527395150 .arrowheadPath{fill:#333333;}#mermaid-1674527395150 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527395150 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527395150 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527395150 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527395150 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527395150 .cluster text{fill:#333;}#mermaid-1674527395150 .cluster span{color:#333;}#mermaid-1674527395150 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527395150 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-a LE-tagsInputWithValue" id="L-a-tagsInputWithValue" style="opacity: 1;"><path class="path" d="M88.28125,184.5L88.28125,180.25C88.28125,176,88.28125,167.5,120.7734375,158.02721331126205C153.265625,148.55442662252412,218.25,138.10885324504824,250.7421875,132.88606655631028L283.234375,127.66327986757236" marker-end="url(#arrowhead14)" style="fill:none"></path><defs><marker id="arrowhead14" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-b LE-tagsInputWithValue" id="L-b-tagsInputWithValue" style="opacity: 1;"><path class="path" d="M362.015625,184L362.015625,179.83333333333334C362.015625,175.66666666666666,362.015625,167.33333333333334,362.015625,159C362.015625,150.66666666666666,362.015625,142.33333333333334,362.015625,138.16666666666666L362.015625,134" marker-end="url(#arrowhead15)" style="fill:none"></path><defs><marker id="arrowhead15" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-c LE-tagsInputWithValue" id="L-c-tagsInputWithValue" style="opacity: 1;"><path class="path" d="M720.71875,184L720.71875,179.83333333333334C720.71875,175.66666666666666,720.71875,167.33333333333334,674.0651041666666,157.44393866794442C627.4114583333334,147.5545440025555,534.1041666666666,136.109088005111,487.4505208333333,130.38636000638874L440.796875,124.66363200766651" marker-end="url(#arrowhead16)" style="fill:none"></path><defs><marker id="arrowhead16" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-tagsInputWithValue LE-TagsInput" id="L-tagsInputWithValue-TagsInput" style="opacity: 1;"><path class="path" d="M362.015625,96L362.015625,91.83333333333333C362.015625,87.66666666666667,362.015625,79.33333333333333,362.015625,71C362.015625,62.666666666666664,362.015625,54.333333333333336,362.015625,50.166666666666664L362.015625,46" marker-end="url(#arrowhead17)" style="fill:none"></path><defs><marker id="arrowhead17" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-a-tagsInputWithValue" class="edgeLabel L-LS-a' L-LE-tagsInputWithValue"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-b-tagsInputWithValue" class="edgeLabel L-LS-b' L-LE-tagsInputWithValue"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-c-tagsInputWithValue" class="edgeLabel L-LS-c' L-LE-tagsInputWithValue"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-tagsInputWithValue-TagsInput" class="edgeLabel L-LS-tagsInputWithValue' L-LE-TagsInput"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-a-8" transform="translate(88.28125,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-80.28125" y="-19" width="160.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-70.28125,-9)"><foreignObject width="140.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: add and delete</div></foreignObject></g></g></g><g class="node default" id="flowchart-tagsInputWithValue-9" transform="translate(362.015625,115)" style="opacity: 1;"><rect rx="0" ry="0" x="-78.78125" y="-19" width="157.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-68.78125,-9)"><foreignObject width="137.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">tagsInputWithValue</div></foreignObject></g></g></g><g class="node default" id="flowchart-b-10" transform="translate(362.015625,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-143.453125" y="-19.5" width="286.90625" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-133.453125,-9.5)"><foreignObject width="266.90625" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test: 후보에 없는 값은 추가 되지 않는다</div></foreignObject></g></g></g><g class="node default" id="flowchart-c-12" transform="translate(720.71875,203.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-165.25" y="-19.5" width="330.5" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-155.25,-9.5)"><foreignObject width="310.5" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">text: 2개 제한을 넘으면 input이 보이지 않는다</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-15" transform="translate(362.015625,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g></g></g></g></svg></p>
<h2 id="좁은-인터페이스-넓은-인터페이스">좁은 인터페이스, 넓은 인터페이스</h2>
<p>그러면 변수나 함수를 추출하면서 무엇이 변한 걸까요? 두루뭉술한 느낌을 명확한 말로 옮겨봅시다.</p>
<p>바로 넓은 public 인터페이스로 세부 구현을 노출하는 대신, 딱 필요한 initValue의 인터페이스만 노출하고 나머지는 private으로 감추었다는 것입니다.</p>
<p>여기서 흔히 객체지향 만의 전유물이라 오해되는 <strong>public/private</strong>, <strong>인터페이스와 구현(implementation)</strong>, <strong>캡슐화(encapsulation)</strong> 를 함수적으로 이해할 수 있습니다.</p>
<p>인터페이스는 두 시스템이 만나는 경계를 뜻합니다. 여기서는 <code>TagsInput</code>이라는 컴포넌트와, 이에 의존하는 test들이 만나고 있습니다.</p>
<p><svg id="mermaid-1674527395478" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="54" style="max-width: 352.984px; background-color: transparent;" viewBox="0 0 352.984375 54"><style>#mermaid-1674527395478 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527395478 .error-icon{fill:#552222;}#mermaid-1674527395478 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527395478 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527395478 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527395478 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527395478 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527395478 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527395478 .marker{fill:#666;stroke:#666;}#mermaid-1674527395478 .marker.cross{stroke:#666;}#mermaid-1674527395478 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527395478 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527395478 .cluster-label text{fill:#333;}#mermaid-1674527395478 .cluster-label span{color:#333;}#mermaid-1674527395478 .label text,#mermaid-1674527395478 span{fill:#000000;color:#000000;}#mermaid-1674527395478 .node rect,#mermaid-1674527395478 .node circle,#mermaid-1674527395478 .node ellipse,#mermaid-1674527395478 .node polygon,#mermaid-1674527395478 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527395478 .node .label{text-align:center;}#mermaid-1674527395478 .node.clickable{cursor:pointer;}#mermaid-1674527395478 .arrowheadPath{fill:#333333;}#mermaid-1674527395478 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527395478 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527395478 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527395478 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527395478 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527395478 .cluster text{fill:#333;}#mermaid-1674527395478 .cluster span{color:#333;}#mermaid-1674527395478 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527395478 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-tagsInputWithValue LE-TagsInput" id="L-tagsInputWithValue-TagsInput" style="opacity: 1;"><path class="path" d="M165.5625,27L173.06510416666666,27C180.56770833333334,27,195.57291666666666,27,210.578125,27C225.58333333333334,27,240.58854166666666,27,248.09114583333334,27L255.59375,27" marker-end="url(#arrowhead8)" style="fill:none"></path><defs><marker id="arrowhead8" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(210.578125,27)" style="opacity: 1;"><g transform="translate(-20.015625,-9)" class="label"><rect rx="0" ry="0" width="40.03125" height="30"></rect><foreignObject width="40.03125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-tagsInputWithValue-TagsInput" class="edgeLabel L-LS-tagsInputWithValue' L-LE-TagsInput">props</span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-tagsInputWithValue-2" transform="translate(86.78125,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-78.78125" y="-19" width="157.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-68.78125,-9)"><foreignObject width="137.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">tagsInputWithValue</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-3" transform="translate(300.2890625,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g></g></g></g></svg></p>
<p><code>TagsInput</code> 컴포넌트는 많은 props를 주입할 수 있게 공개하고 있습니다. <code>label</code>이나 <code>name</code>, <code>initValue</code>등을 원하는 값으로 주입할 수 있죠.</p>
<p>이렇게 밖에서 제어할 수 있거나, 메세지를 보낼 수 있게 외부에 공개한 부분을 보통 public interface라 합니다. 함수의 public 인터페이스는? 파라미터와 반환하는 값의 타입. 즉 함수의 타입(type)입니다.</p>
<p>하지만 인터페이스가 넓을 수록, 사용하기는 불편하고 신경 쓸 게 많아집니다. 잘못 사용하기도 쉽고요. 너무 많은 부분에 의존하기 때문에, 앞서 보신 것처럼 인터페이스 변경에도 취약해집니다.</p>
<p>이는 인터페이스 사용자와, 제공자에게 모두 제약입니다. 사용자는 제공자가 인터페이스를 바꾸고 파괴적 변경을 하면 어떻게 하나 걱정하게 되고요. 인터페이스를 제공하는 쪽에서도 섣불리 인터페이스를 변경할 수 없게 됩니다.</p>
<p>그래서 딱 필요한 부분에만 의존하고, 공개하는 게 좋습니다. 그러면 사용하는 쪽에서도 쉽게 의존성을 사용할 수 있고, 제공하는 쪽에서도 내부 구현을 고칠 수 있으니까요.</p>
<p><svg id="mermaid-1674527395787" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="55" style="max-width: 523.969px; background-color: transparent;" viewBox="0 0 523.96875 55"><style>#mermaid-1674527395787 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527395787 .error-icon{fill:#552222;}#mermaid-1674527395787 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527395787 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527395787 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527395787 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527395787 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527395787 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527395787 .marker{fill:#666;stroke:#666;}#mermaid-1674527395787 .marker.cross{stroke:#666;}#mermaid-1674527395787 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527395787 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527395787 .cluster-label text{fill:#333;}#mermaid-1674527395787 .cluster-label span{color:#333;}#mermaid-1674527395787 .label text,#mermaid-1674527395787 span{fill:#000000;color:#000000;}#mermaid-1674527395787 .node rect,#mermaid-1674527395787 .node circle,#mermaid-1674527395787 .node ellipse,#mermaid-1674527395787 .node polygon,#mermaid-1674527395787 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527395787 .node .label{text-align:center;}#mermaid-1674527395787 .node.clickable{cursor:pointer;}#mermaid-1674527395787 .arrowheadPath{fill:#333333;}#mermaid-1674527395787 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527395787 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527395787 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527395787 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527395787 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527395787 .cluster text{fill:#333;}#mermaid-1674527395787 .cluster span{color:#333;}#mermaid-1674527395787 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527395787 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-test들 LE-tagsInputWithValue" id="L-test들-tagsInputWithValue" style="opacity: 1;"><path class="path" d="M68.796875,27.5L77.97916666666667,27.5C87.16145833333333,27.5,105.52604166666667,27.5,123.890625,27.5C142.25520833333334,27.5,160.61979166666666,27.5,169.80208333333334,27.5L178.984375,27.5" marker-end="url(#arrowhead14)" style="fill:none"></path><defs><marker id="arrowhead14" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-tagsInputWithValue LE-TagsInput" id="L-tagsInputWithValue-TagsInput" style="opacity: 1;"><path class="path" d="M336.546875,27.5L344.0494791666667,27.5C351.5520833333333,27.5,366.5572916666667,27.5,381.5625,27.5C396.5677083333333,27.5,411.5729166666667,27.5,419.0755208333333,27.5L426.578125,27.5" marker-end="url(#arrowhead15)" style="fill:none"></path><defs><marker id="arrowhead15" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(123.890625,27.5)" style="opacity: 1;"><g transform="translate(-30.09375,-9)" class="label"><rect rx="0" ry="0" width="60.1875" height="30"></rect><foreignObject width="60.1875" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-test들-tagsInputWithValue" class="edgeLabel L-LS-test들' L-LE-tagsInputWithValue">initValue</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(381.5625,27.5)" style="opacity: 1;"><g transform="translate(-20.015625,-9)" class="label"><rect rx="0" ry="0" width="40.03125" height="30"></rect><foreignObject width="40.03125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-tagsInputWithValue-TagsInput" class="edgeLabel L-LS-tagsInputWithValue' L-LE-TagsInput">props</span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-test들-4" transform="translate(38.3984375,27.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30.3984375" y="-19.5" width="60.796875" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-20.3984375,-9.5)"><foreignObject width="40.796875" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test들</div></foreignObject></g></g></g><g class="node default" id="flowchart-tagsInputWithValue-5" transform="translate(257.765625,27.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-78.78125" y="-19" width="157.5625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-68.78125,-9)"><foreignObject width="137.5625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">tagsInputWithValue</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-7" transform="translate(471.2734375,27.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g></g></g></g></svg></p>
<p>예시로 돌아가면 <code>tagsInputWithValue</code>는 initValue라는 단 하나의 파라미터만 공개하고 있습니다. labelText나 name을 비롯한 여러 값들은 적절한 디폴트 값을 주입해주고 있죠. 이는 private으로 감추고, 캡슐화한 구현 상세입니다.</p>
<p>매개변수 하나만 지정해주면 되기 때문에 사용하기 편리합니다. <code>TagsInput</code>에 새로운 props가 추가되거나, 삭제되거나, 이름이 바뀌더라도 <code>tagsInputWithValue</code>만 수정해주면 되고요. 기존의 test들은 똑같은 인터페이스를 사용할 수 있습니다.</p>
<p>물론 제어할 수 있는 부분이 전혀 없어도 문제입니다.</p>
<p><svg id="mermaid-1674527396118" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="142" style="max-width: 502.344px; background-color: transparent;" viewBox="0 0 502.34375 142"><style>#mermaid-1674527396118 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-1674527396118 .error-icon{fill:#552222;}#mermaid-1674527396118 .error-text{fill:#552222;stroke:#552222;}#mermaid-1674527396118 .edge-thickness-normal{stroke-width:2px;}#mermaid-1674527396118 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1674527396118 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1674527396118 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1674527396118 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1674527396118 .marker{fill:#666;stroke:#666;}#mermaid-1674527396118 .marker.cross{stroke:#666;}#mermaid-1674527396118 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1674527396118 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-1674527396118 .cluster-label text{fill:#333;}#mermaid-1674527396118 .cluster-label span{color:#333;}#mermaid-1674527396118 .label text,#mermaid-1674527396118 span{fill:#000000;color:#000000;}#mermaid-1674527396118 .node rect,#mermaid-1674527396118 .node circle,#mermaid-1674527396118 .node ellipse,#mermaid-1674527396118 .node polygon,#mermaid-1674527396118 .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-1674527396118 .node .label{text-align:center;}#mermaid-1674527396118 .node.clickable{cursor:pointer;}#mermaid-1674527396118 .arrowheadPath{fill:#333333;}#mermaid-1674527396118 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-1674527396118 .flowchart-link{stroke:#666;fill:none;}#mermaid-1674527396118 .edgeLabel{background-color:white;text-align:center;}#mermaid-1674527396118 .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-1674527396118 .cluster rect{fill:hsl(0, 0%, 98.9215686275%);stroke:#707070;stroke-width:1px;}#mermaid-1674527396118 .cluster text{fill:#333;}#mermaid-1674527396118 .cluster span{color:#333;}#mermaid-1674527396118 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160, 0%, 93.3333333333%);border:1px solid #707070;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1674527396118 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath LS-test들 LE-emptyTagsInputElement" id="L-test들-emptyTagsInputElement" style="opacity: 1;"><path class="path" d="M62.95001775568181,90.5L68.09116062973484,94.58333333333333C73.23230350378788,98.66666666666667,83.51458925189394,106.83333333333333,93.19479462594695,110.91666666666667C102.875,115,111.953125,115,116.4921875,115L121.03125,115" marker-end="url(#arrowhead16)" style="fill:none"></path><defs><marker id="arrowhead16" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-test들 LE-doubleTagsInputElement" id="L-test들-doubleTagsInputElement" style="opacity: 1;"><path class="path" d="M62.95001775568181,51.5L68.09116062973484,47.416666666666664C73.23230350378788,43.333333333333336,83.51458925189394,35.166666666666664,92.82239879261363,31.083333333333332C102.13020833333333,27,110.46354166666667,27,114.63020833333333,27L118.796875,27" marker-end="url(#arrowhead17)" style="fill:none"></path><defs><marker id="arrowhead17" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-doubleTagsInputElement LE-TagsInput" id="L-doubleTagsInputElement-TagsInput" style="opacity: 1;"><path class="path" d="M314.921875,27L322.4244791666667,27C329.9270833333333,27,344.9322916666667,27,360.93024976325756,31.166666666666668C376.9282078598485,35.333333333333336,393.918915719697,43.666666666666664,402.4142696496212,47.833333333333336L410.90962357954544,52" marker-end="url(#arrowhead18)" style="fill:none"></path><defs><marker id="arrowhead18" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-emptyTagsInputElement LE-TagsInput" id="L-emptyTagsInputElement-TagsInput" style="opacity: 1;"><path class="path" d="M312.6875,115L320.5625,115C328.4375,115,344.1875,115,360.55785392992425,110.83333333333333C376.9282078598485,106.66666666666667,393.918915719697,98.33333333333333,402.4142696496212,94.16666666666667L410.90962357954544,90" marker-end="url(#arrowhead19)" style="fill:none"></path><defs><marker id="arrowhead19" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-test들-emptyTagsInputElement" class="edgeLabel L-LS-test들' L-LE-emptyTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><rect rx="0" ry="0" width="0" height="0"></rect><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-test들-doubleTagsInputElement" class="edgeLabel L-LS-test들' L-LE-doubleTagsInputElement"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(359.9375,27)" style="opacity: 1;"><g transform="translate(-20.015625,-9)" class="label"><rect rx="0" ry="0" width="40.03125" height="30"></rect><foreignObject width="40.03125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-doubleTagsInputElement-TagsInput" class="edgeLabel L-LS-doubleTagsInputElement' L-LE-TagsInput">props</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(359.9375,115)" style="opacity: 1;"><g transform="translate(-20.015625,-9)" class="label"><rect rx="0" ry="0" width="40.03125" height="30"></rect><foreignObject width="40.03125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-emptyTagsInputElement-TagsInput" class="edgeLabel L-LS-emptyTagsInputElement' L-LE-TagsInput">props</span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-test들-8" transform="translate(38.3984375,71)" style="opacity: 1;"><rect rx="0" ry="0" x="-30.3984375" y="-19.5" width="60.796875" height="39" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-20.3984375,-9.5)"><foreignObject width="40.796875" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">test들</div></foreignObject></g></g></g><g class="node default" id="flowchart-emptyTagsInputElement-9" transform="translate(216.859375,115)" style="opacity: 1;"><rect rx="0" ry="0" x="-95.828125" y="-19" width="191.65625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-85.828125,-9)"><foreignObject width="171.65625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">emptyTagsInputElement</div></foreignObject></g></g></g><g class="node default" id="flowchart-doubleTagsInputElement-11" transform="translate(216.859375,27)" style="opacity: 1;"><rect rx="0" ry="0" x="-98.0625" y="-19" width="196.125" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-88.0625,-9)"><foreignObject width="176.125" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">doubleTagsInputElement</div></foreignObject></g></g></g><g class="node default" id="flowchart-TagsInput-13" transform="translate(449.6484375,71)" style="opacity: 1;"><rect rx="0" ry="0" x="-44.6953125" y="-19" width="89.390625" height="38" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-34.6953125,-9)"><foreignObject width="69.390625" height="30"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TagsInput</div></foreignObject></g></g></g></g></g></g></svg></p>
<p>앞에서 변수로 추출했던 <code>emptyTagsInputElement</code>는 값이 없는 <code>TagsInput</code> element일 뿐이었습니다. 거의 모든 게 private인 셈입니다. 제어할 수 있는 부분이 전혀 없기 때문에, 다양한 테스트에서 활용할 수 없었지요.</p>
<p>이렇듯 넓은 인터페이스와 좁은 인터페이스라는 양극단 사이에서 균형을 잘 잡아야 합니다. 늘 그렇듯이 잘 관찰하고, 예측하고 결정을 내리시길 바랍니다.</p>
<h2 id="오해-바로잡기-매개변수가-많다고-넓은-인터페이스는-아니다">오해 바로잡기. 매개변수가 많다고 넓은 인터페이스는 아니다.</h2>
<p>여기서 오해를 하나 짚고 넘어가자면. 매개변수가 많다고 무조건 넓은 인터페이스인 것은 아닙니다. 때로는 하나의 수퍼 메서드보다, 여러 개의 구체적인 메서드를 노출하는 게 더 안전한 경우도 많아요.</p>
<p>흔한 예를 들자면 <code>setter</code>야 말로 너무 넓고, 위험한 인터페이스의 예시라고 할 수 있습니다. 프런트엔드에서는 <code>setState</code>를 이리저리 내려주며 공유하거나, <code>=</code> 으로 ref나 reactive 등에 직접 값을 할당하는 경우가 있겠습니다.</p>
<p>왜냐하면 setter는 상태가 어떤 형태이며, 어떻게 업데이트할지를 매번 정해줘야 하기 때문입니다. 그래서 <code>setter</code>는 안티패턴이라 하는 분도 있습니다. "<code>set</code>을 외부에 공개하지 말아라!"하고 말이죠.</p>
<p>예를 들어 todoList를 만든다면 setter는 다음과 같이 구현이 곳곳에 흩어지게 됩니다. 제가 일부러 에러도 심어놓았는데, 한 번 찾아보시죠. ;)</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">TodoList</span><span style="color: #89DDFF">(){</span></span>
<span class="line"><span style="color: #F07178">  [</span><span style="color: #A6ACCD">todoList</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">setTodoList</span><span style="color: #F07178">] </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #82AAFF">useState</span><span style="color: #89DDFF">&lt;</span><span style="color: #FFCB6B">TodoT</span><span style="color: #F07178">[]</span><span style="color: #89DDFF">&gt;</span><span style="color: #F07178">([])</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> (</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">ul</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #89DDFF">{</span><span style="color: #A6ACCD">todoList</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #A6ACCD">(todo </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">li</span><span style="color: #89DDFF"> </span><span style="color: #C792EA">key</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #89DDFF">}&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">input</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">type</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">checkbox</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">checked</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">aria-label</span><span style="color: #89DDFF">={</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">할일 </span><span style="color: #89DDFF">${</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">content</span><span style="color: #89DDFF">}</span><span style="color: #C3E88D"> 완료하기</span><span style="color: #89DDFF">`</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">onClick</span><span style="color: #89DDFF">={()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">                </span><span style="color: #82AAFF">setTodoList</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">old</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">old</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">item</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178"> </span><span style="color: #89DDFF">===</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178"> </span><span style="color: #89DDFF">?</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> checked</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">!</span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">checked</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #F07178"> </span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todo</span><span style="color: #F07178"> ))</span></span>
<span class="line"><span style="color: #F07178">              </span><span style="color: #89DDFF">}}</span></span>
<span class="line"><span style="color: #89DDFF">            /&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">{</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">content</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">button</span><span style="color: #89DDFF"> </span><span style="color: #C792EA">onClick</span><span style="color: #89DDFF">={()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">              </span><span style="color: #82AAFF">setTodoList</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">old</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">old</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">filter</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">item</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178"> </span><span style="color: #89DDFF">!==</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">            </span><span style="color: #89DDFF">}}&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">              삭제</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">button</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">li</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">      ))</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">ul</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #F07178">  )</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>이런 경우에는 좁은 함수들을 만들어서, ui에서는 만들어진 함수를 사용하기만 하면 좋습니다. 예를 들어 다음처럼 <code>completeTodo</code>와 <code>deleteTodo</code>를 만들면, 각각 <code>id</code>에만 의존하니, 더 좁은 인터페이스가 됩니다. 에러도 같이 고쳤으니 비교하며 디버깅 연습을 해보셔도 좋겠습니다.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">TodoList</span><span style="color: #89DDFF">(){</span></span>
<span class="line"><span style="color: #F07178">  [</span><span style="color: #A6ACCD">todoList</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">setTodoList</span><span style="color: #F07178">] </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #82AAFF">useState</span><span style="color: #F07178">([])</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">completeTodo</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">targetId</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">TodoT</span><span style="color: #F07178">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">]</span><span style="color: #89DDFF">){</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">setTodoList</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">old</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">old</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">item</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178"> </span><span style="color: #89DDFF">===</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">targetId</span><span style="color: #F07178"> </span><span style="color: #89DDFF">?</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> checked</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">!</span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">checked</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #F07178"> </span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">item</span><span style="color: #F07178"> ))</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">deleteTodo</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">targetId</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">TodoT</span><span style="color: #F07178">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">]</span><span style="color: #89DDFF">){</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">setTodoList</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">old</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">old</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">filter</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">item</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">item</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178"> </span><span style="color: #89DDFF">!==</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">targetId</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> (</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">ul</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">      </span><span style="color: #89DDFF">{</span><span style="color: #A6ACCD">todoList</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #A6ACCD">(todo </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> (</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">li</span><span style="color: #89DDFF"> </span><span style="color: #C792EA">key</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #89DDFF">}&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">input</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">type</span><span style="color: #89DDFF">=</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">checkbox</span><span style="color: #89DDFF">&quot;</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">checked</span><span style="color: #89DDFF">={</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">aria-label</span><span style="color: #89DDFF">={</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">할일 </span><span style="color: #89DDFF">${</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">content</span><span style="color: #89DDFF">}</span><span style="color: #C3E88D"> 완료하기</span><span style="color: #89DDFF">`</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">              </span><span style="color: #C792EA">onClick</span><span style="color: #89DDFF">={()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span><span style="color: #82AAFF">completeTodo</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178">)</span><span style="color: #89DDFF">}}</span></span>
<span class="line"><span style="color: #89DDFF">            /&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">{</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">content</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">button</span><span style="color: #89DDFF"> </span><span style="color: #C792EA">onClick</span><span style="color: #89DDFF">={()</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #82AAFF">deleteTodo</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">todo</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">id</span><span style="color: #F07178">) </span><span style="color: #89DDFF">}}&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">              삭제</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">button</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">li</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #A6ACCD">      ))</span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">ul</span><span style="color: #89DDFF">&gt;</span></span>
<span class="line"><span style="color: #F07178">  )</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>물론 이러면 코드가 더 복잡해지지만, 이득도 큽니다. ui가 <code>useState</code> api에 직접 의존하지 않기 때문에, 다른 api를 쓰는 라이브러리도 쉽게 적용할 수 있지요.</p>
<p>예를 들어 위의 코드를 redux를 사용하게 바꾸더라도, return해주는 ui는 전혀 변경하지 않아도 됩니다. 어떤 분은 여기서 커스텀 훅을 추출했으면 더 좋지 않았을까 생각하실지도 모르겠어요. ;)</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">TodoList</span><span style="color: #89DDFF">(){</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todoList</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #82AAFF">useSelector</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">state</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">todoList</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">dispatch</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #82AAFF">useDispatch</span><span style="color: #F07178">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">completeTodo</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">targetId</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">TodoT</span><span style="color: #F07178">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">]</span><span style="color: #89DDFF">){</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">dispatch</span><span style="color: #F07178">(</span><span style="color: #82AAFF">completeTodoAction</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">targetId</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">deleteTodo</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">targetId</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">TodoT</span><span style="color: #F07178">[</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">]</span><span style="color: #89DDFF">){</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">dispatch</span><span style="color: #F07178">(</span><span style="color: #82AAFF">deleteTodoAction</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">targetId</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> (</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">// ... 그대로</span></span>
<span class="line"><span style="color: #F07178">  )</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<h2 id="개념은-하나-적용은-무궁무진">개념은 하나, 적용은 무궁무진</h2>
<p>이런 예시를 통해 어떤 추상적인 개념을 설명할 때면 늘 걱정이 됩니다. 왜냐하면 추상적인 개념을 한 두 가지 예시로 설명하면, 응용하지 못하시는 경우가 많거든요.</p>
<p>저는 변수와 함수 추출을 밥 먹듯이 씁니다. 만약에 같이 변해야 하는 걸 복사 붙여넣기를 하고 있다면, 보통 추출해야 한다는 징조인 경우가 많습니다. 이는 테스트 뿐만이 아니고, 온갖 상황에서 그렇습니다.</p>
<p>여러분도 프로젝트에서 변수나 함수를 추출할 수 있는 경우를 잘 찾아보시면 좋겠습니다.</p>
<p>예를 들어 저는 의존성 주입 도구가 없는 프레임워크로 디비나 파일 같은 의존성을 사용할 때, 인터페이스를 정의하고 repository 구현체를 만들어서 위에 변수로 alias를 만들어서 빼놓습니다. 다음처럼요.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #89DDFF; font-style: italic">import</span><span style="color: #A6ACCD"> fsRepository </span><span style="color: #89DDFF; font-style: italic">from</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">./fsRepository</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #C792EA">const</span><span style="color: #A6ACCD"> repository</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">ITodoRepository</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> fsRepository</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #676E95; font-style: italic">// ... 생략</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6ACCD">server</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #A6ACCD">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/todo-list</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> opts</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">request</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> reply</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todoList</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">repository</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getAll</span><span style="color: #F07178">()</span><span style="color: #89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #A6ACCD">reply</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">status</span><span style="color: #F07178">(</span><span style="color: #F78C6C">200</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">todoList</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #A6ACCD">)</span><span style="color: #89DDFF">;</span></span></code></pre>
<p>너무 단순해서, 이게 어떤 의미가 있나 싶으실 겁니다. 하지만 여러모로 장점이 많습니다. 나중에 테스트를 위해 <code>fakeRepository</code>를 쓰고 싶다면, <code>repository</code>에 <code>fakeRepository</code>를 할당해주면 됩니다. 프로덕션에서 <code>fsRepository</code>를 <code>typeOrmRepository</code>로 바꾸고 싶다고 해도 마찬가지입니다.</p>
<p><code>repository</code> 변수를 사용하는 라우터들은 이게 어떤 repository 구현체를 쓰는지 알지 못하고 <code>ITodoRepository</code> 인터페이스에 정의된 메서드만 사용하기 때문에, 자연스럽게 특정 repository 구현체와 결합되는 걸 피할 수도 있습니다.</p>
<p>이렇듯 중간에 변수나 함수 하나를 만드는 것은. 거창한 의존성 주입 프레임워크나 수 많은 파일들 없이도, 쉽게 코드 간의 결합을 낮출 수 있는 방법입니다. 여러분의 코드로 돌아가서 적용할 수 있는 부분을 찾아보시길 바라요.</p>
<blockquote>
<p>여담이지만 변수와 함수 추출은 프런트와 백엔드 뿐만 아니라, 웹이 없던 시절부터 내려오는 기법입니다. 궁금하신 분들은 변수와 함수라는 개념이 처음 만들어진 역사를 살펴보시면 재미있겠습니다.</p>
</blockquote>
<h2 id="언제든지-돌아갈-수-있다">언제든지 돌아갈 수 있다</h2>
<p>이런 클린한 아키텍처 어쩌구를 들으면, 진절머리가 나시는 분들도 있습니다. 좋다는 아키텍처를 따라해보려다가 괜히 복잡해지기만 했다면서 말이죠. 성급한 추상화를 했다가, 같이 변경되는 역할이나 범위를 잘못 파악해서 결국 다 뜯어고치는 경우도 있습니다.</p>
<p>변수와 함수 추출의 큰 장점은, 되돌리기 쉽다는 것입니다. 마틴 파울러는 [리팩토링] 책에서 추출 말고도 '인라인' 리팩토링을 소개하고 있습니다. 추출이 여러 중복되는 값을 하나의 변수나 함수로 추출하는 것이라면. 인라인은 거꾸로 하나의 변수나 함수를 사용하는 곳에 구체적인 값으로 되돌리는 겁니다.</p>
<p>앞으로도 여러 방법들을 소개해드리고 비교해볼텐데요. 안전하면서도 빠르게 분리해내고, 다시 되돌릴 수 있다면. 더 자신 있게 리팩토링 할 수 있습니다. 추출하고 인라인하는 연습을 해보세요. 에디터의 단축키나 replace, 자동 리팩토링 기능을 배워두시면 좋습니다.</p>
<p>테스트가 있으면, 구현을 바꿀 수 있듯이. 테스트를 리팩토링하는 것도 마찬가지입니다. 구현을 바꾸지 않았는데, 테스트가 실패한다면? 리팩토링을 잘못한 것이겠죠. 비슷하게 구현을 망가트렸는데, 테스트가 통과해버린다면? 이 역시 테스트를 망가트렸다는 신호입니다. 테스트나 구현이나 인간이 만든 것이니, 상호 검증을 해주시면서 내가 정확하게 리팩토링을 하고 있는지 피드백을 받아보시길 바랍니다.</p>
<h2 id="다음-회-예고-prop-내리기와-의존성-주입의-고통">다음 회 예고... prop 내리기와 의존성 주입의 고통</h2>
<p>변수와 함수 추출은 단순하지만, 한계도 분명합니다. 예를 들어 scope에 따른 namespace 충돌 같은 문제라던가요. 의존성을 주입하는 이유와 방법은, 제 머릿 속에만 10가지가 넘습니다. 앞으로 그런 방법들을 하나씩 다뤄가려 합니다.</p>
<p>다음에는 <code>module</code>이나 <code>context</code>를 다뤄보려 합니다.</p>
<p>import/export나 파일 분리/계층 구조와 같은 모듈화는 흔한 의존성 주입의 방법입니다. 어떻게 보면 mock이나 fake 같은 기법도 그러하며, 번들러를 비롯한 여러 도구는 alias를 비롯해 여러 신기한 기능도 제공합니다. 역사가 긴 만큼 많은 문제를 해결해온 기법이기도 합니다. 저희가 모듈이나 패키지를 의존성Dependency라고 부르는 이유이기도 하고요.</p>
<p>또한 여러 웹 프레임워크는 <code>context</code> / <code>provider</code> / <code>inject</code> 와 같은 개념을 가지고 있기도 한데요. <code>context</code>라는 말을 들을 때마다 이게 무엇인지 궁금하셨을 분도 있을 것 같습니다. 여러 프레임워크의 <code>context</code>를 비교해보면서, 그 용도와 장단점을 다뤄보겠습니다. 물론 테스트와 함께요.</p>
<p>여기까지 읽어주셔서 감사합니다. 언제가 될지 약속은 못하겠지만, 또 돌아올게요. 다음에 뵙겠습니다.</p>
<!-- HTML_TAG_END -->

<div><script src="https://utteranc.es/client.js" repo="twinstae/twinstae.github.io" issue-term="pathname" label="댓글" theme="github-dark-orange" crossorigin="anonymous" async=""></script>
</div><!-- HTML_TAG_END --></article>

<footer class="footer svelte-d4ohrk">이 블로그는 <a href="https://svelte.dev/" class="svelte-d4ohrk">Svelte</a>와
  <a class="secondary svelte-d4ohrk" href="https://elderguide.com/tech/elderjs/">Elder.js</a>로 만들었습니다.
  <br>
  디자인은 <a href="https://www.getpapercss.com/docs/" class="svelte-d4ohrk">PaperCSS</a>를 기본으로
  커스텀했습니다.
  <br>
  폰트는 <a href="https://cactus.tistory.com/306" class="svelte-d4ohrk">Pretendard</a>를 사용합니다.
  <br>
  <a href="https://pages.github.com/" class="svelte-d4ohrk">Github Pages</a>로 호스팅하고 있습니다.
  <br>
  오픈소스 개발자분들과 무료 호스팅 서비스에 감사드립니다. :)
</footer>
    
    <script type="module">
            const requestIdleCallback = window.requestIdleCallback || ( cb => window.setTimeout(cb,1) );
      
const $$ejs = (par,eager)=>{
  const $ejs = function(_ejs){return _ejs};
  const prefix = '/_elderjs';
  const initComponent = (target, component) => {

    if(!!CustomEvent && target.id){
      const split = target.id.split('-ejs-');
      document.dispatchEvent(new CustomEvent('ejs', {
        detail: {
          category: 'elderjs',
          action: 'hydrate',
          target: target,
          label: split[0] || target.id
        }
      }));
    }

    const propProm = ((typeof component.props === 'string') ? fetch(prefix+'/props/'+ component.props).then(p => p.json()).then(r => $ejs(r)) : new Promise((resolve) => resolve($ejs(component.props))));
    const compProm = import(prefix + '/svelte/components/' + component.component);

    Promise.all([compProm,propProm]).then(([comp,props])=>{
      new comp.default({ 
        target: target,
        props: props,
        hydrate: true
      });
    });
  };
  
  Object.keys(par).forEach(k => {
    const el = document.getElementById(k);
    if (false) {
        IO.observe(el);
    } else {
        initComponent(el,par[k]);
    }
  });
};

      $$ejs({'darkcheckbox-ejs-LQkbMnstNJ' : { 'component' : 'DarkCheckBox.d7e8c32b.js', 'props' : {}},},true)</script>
    
    
    </body></html>